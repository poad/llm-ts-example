import { logger } from '@llm-ts-example/common-backend';
import { createAgent } from './agent.js';
export const handle = async ({ message: message = 'こんにちは！', model: model = 'us.amazon.nova-micro-v1:0' }, output) => {
    const agent = createAgent({ model });
    for await (const event of agent.stream(message)) {
        // console.log('[Event]', event.type);
        if (event.type === 'modelContentBlockDeltaEvent') {
            if (event.delta.type === 'textDelta') {
                output.write(event.delta.text);
            }
        }
    }
};
export const handler = awslambda.streamifyResponse(async (event, responseStream) => {
    logger.debug('event', { event });
    const { message, model } = event.body ? JSON.parse(event.body) : {};
    await handle({ message, model }, responseStream);
    responseStream.end();
});
export default handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV6QyxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsS0FBSyxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sR0FBRyxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssR0FBRywyQkFBMkIsRUFBc0MsRUFBRSxNQUE2QixFQUFFLEVBQUU7SUFDN0ssTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNyQyxJQUFJLEtBQUssRUFBRSxNQUFNLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDaEQsc0NBQXNDO1FBQ3RDLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyw2QkFBNkIsRUFBRSxDQUFDO1lBQ2pELElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssV0FBVyxFQUFFLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLGlCQUFpQixDQUNoRCxLQUFLLEVBQ0gsS0FBMkIsRUFBRSxjQUFxQyxFQUNsRSxFQUFFO0lBQ0YsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNwRSxNQUFNLE1BQU0sQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNqRCxjQUFjLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUM7QUFFTCxlQUFlLE9BQU8sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0BsbG0tdHMtZXhhbXBsZS9jb21tb24tYmFja2VuZCc7XG5pbXBvcnQgeyBBUElHYXRld2F5UHJveHlFdmVudCB9IGZyb20gJ2F3cy1sYW1iZGEnO1xuaW1wb3J0IHsgY3JlYXRlQWdlbnQgfSBmcm9tICcuL2FnZW50LmpzJztcblxuZXhwb3J0IGNvbnN0IGhhbmRsZSA9IGFzeW5jICh7IG1lc3NhZ2U6IG1lc3NhZ2UgPSAn44GT44KT44Gr44Gh44Gv77yBJywgbW9kZWw6IG1vZGVsID0gJ3VzLmFtYXpvbi5ub3ZhLW1pY3JvLXYxOjAnIH06IHsgbWVzc2FnZTogc3RyaW5nLCBtb2RlbDogc3RyaW5nIH0sIG91dHB1dDogTm9kZUpTLldyaXRhYmxlU3RyZWFtKSA9PiB7XG4gIGNvbnN0IGFnZW50ID0gY3JlYXRlQWdlbnQoeyBtb2RlbCB9KTtcbiAgZm9yIGF3YWl0IChjb25zdCBldmVudCBvZiBhZ2VudC5zdHJlYW0obWVzc2FnZSkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnW0V2ZW50XScsIGV2ZW50LnR5cGUpO1xuICAgIGlmIChldmVudC50eXBlID09PSAnbW9kZWxDb250ZW50QmxvY2tEZWx0YUV2ZW50Jykge1xuICAgICAgaWYgKGV2ZW50LmRlbHRhLnR5cGUgPT09ICd0ZXh0RGVsdGEnKSB7XG4gICAgICAgIG91dHB1dC53cml0ZShldmVudC5kZWx0YS50ZXh0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXdzbGFtYmRhLnN0cmVhbWlmeVJlc3BvbnNlKFxuICBhc3luYyAoXG4gICAgZXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50LCByZXNwb25zZVN0cmVhbTogTm9kZUpTLldyaXRhYmxlU3RyZWFtLFxuICApID0+IHtcbiAgICBsb2dnZXIuZGVidWcoJ2V2ZW50JywgeyBldmVudCB9KTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIG1vZGVsIH0gPSBldmVudC5ib2R5ID8gSlNPTi5wYXJzZShldmVudC5ib2R5KSA6IHt9O1xuICAgIGF3YWl0IGhhbmRsZSh7IG1lc3NhZ2UsIG1vZGVsIH0sIHJlc3BvbnNlU3RyZWFtKTtcbiAgICByZXNwb25zZVN0cmVhbS5lbmQoKTtcbiAgfSk7XG5cbmV4cG9ydCBkZWZhdWx0IGhhbmRsZXI7XG4iXX0=