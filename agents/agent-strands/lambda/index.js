import { logger } from '@llm-ts-example/common-backend';
import { createAgent } from './agent.js';
export const handle = async ({ question: message = 'こんにちは！', model: model = 'us.amazon.nova-micro-v1:0' }, output) => {
    const agent = createAgent({ model });
    for await (const event of agent.stream(message)) {
        // console.log('[Event]', event.type);
        if (event.type === 'modelContentBlockDeltaEvent') {
            if (event.delta.type === 'textDelta') {
                output.write(event.delta.text);
            }
        }
    }
};
export const handler = awslambda.streamifyResponse(async (event, responseStream) => {
    logger.debug('event', { event });
    const { question, model } = event.body ? JSON.parse(event.body) : { question: 'あなたは誰？', model: 'gpt' };
    await handle({ question, model }, responseStream);
    responseStream.end();
});
export default handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV6QyxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sR0FBRyxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssR0FBRywyQkFBMkIsRUFBdUMsRUFBRSxNQUE2QixFQUFFLEVBQUU7SUFDL0ssTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNyQyxJQUFJLEtBQUssRUFBRSxNQUFNLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDaEQsc0NBQXNDO1FBQ3RDLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyw2QkFBNkIsRUFBRSxDQUFDO1lBQ2pELElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssV0FBVyxFQUFFLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLGlCQUFpQixDQUNoRCxLQUFLLEVBQ0gsS0FBMkIsRUFBRSxjQUFxQyxFQUNsRSxFQUFFO0lBQ0YsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUM7SUFDdkcsTUFBTSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDbEQsY0FBYyxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0FBRUwsZUFBZSxPQUFPLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAbGxtLXRzLWV4YW1wbGUvY29tbW9uLWJhY2tlbmQnO1xuaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnQgfSBmcm9tICdhd3MtbGFtYmRhJztcbmltcG9ydCB7IGNyZWF0ZUFnZW50IH0gZnJvbSAnLi9hZ2VudC5qcyc7XG5cbmV4cG9ydCBjb25zdCBoYW5kbGUgPSBhc3luYyAoeyBxdWVzdGlvbjogbWVzc2FnZSA9ICfjgZPjgpPjgavjgaHjga/vvIEnLCBtb2RlbDogbW9kZWwgPSAndXMuYW1hem9uLm5vdmEtbWljcm8tdjE6MCcgfTogeyBxdWVzdGlvbjogc3RyaW5nLCBtb2RlbDogc3RyaW5nIH0sIG91dHB1dDogTm9kZUpTLldyaXRhYmxlU3RyZWFtKSA9PiB7XG4gIGNvbnN0IGFnZW50ID0gY3JlYXRlQWdlbnQoeyBtb2RlbCB9KTtcbiAgZm9yIGF3YWl0IChjb25zdCBldmVudCBvZiBhZ2VudC5zdHJlYW0obWVzc2FnZSkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnW0V2ZW50XScsIGV2ZW50LnR5cGUpO1xuICAgIGlmIChldmVudC50eXBlID09PSAnbW9kZWxDb250ZW50QmxvY2tEZWx0YUV2ZW50Jykge1xuICAgICAgaWYgKGV2ZW50LmRlbHRhLnR5cGUgPT09ICd0ZXh0RGVsdGEnKSB7XG4gICAgICAgIG91dHB1dC53cml0ZShldmVudC5kZWx0YS50ZXh0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXdzbGFtYmRhLnN0cmVhbWlmeVJlc3BvbnNlKFxuICBhc3luYyAoXG4gICAgZXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50LCByZXNwb25zZVN0cmVhbTogTm9kZUpTLldyaXRhYmxlU3RyZWFtLFxuICApID0+IHtcbiAgICBsb2dnZXIuZGVidWcoJ2V2ZW50JywgeyBldmVudCB9KTtcbiAgICBjb25zdCB7IHF1ZXN0aW9uLCBtb2RlbCB9ID0gZXZlbnQuYm9keSA/IEpTT04ucGFyc2UoZXZlbnQuYm9keSkgOiB7IHF1ZXN0aW9uOiAn44GC44Gq44Gf44Gv6Kqw77yfJywgbW9kZWw6ICdncHQnIH07XG4gICAgYXdhaXQgaGFuZGxlKHsgcXVlc3Rpb24sIG1vZGVsIH0sIHJlc3BvbnNlU3RyZWFtKTtcbiAgICByZXNwb25zZVN0cmVhbS5lbmQoKTtcbiAgfSk7XG5cbmV4cG9ydCBkZWZhdWx0IGhhbmRsZXI7XG4iXX0=