import { logger } from '@llm-ts-example/common-backend';
import { createAgent } from './agent.js';
export const handle = async ({ message: message = 'こんにちは！', model: model = 'us.amazon.nova-micro-v1:0' }, output) => {
    const agent = createAgent({ model });
    for await (const event of agent.stream(message)) {
        // console.log('[Event]', event.type);
        if (event.type === 'modelContentBlockDeltaEvent') {
            if (event.delta.type === 'textDelta') {
                output.write(event.delta.text);
            }
        }
    }
};
export const handler = awslambda.streamifyResponse(async (event, responseStream) => {
    logger.debug('event', { event });
    const { message, model } = event.body ? JSON.parse(event.body) : {};
    await handle({ message, model }, responseStream);
    responseStream.end();
});
export default handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV6QyxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsS0FBSyxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sR0FBRyxvQkFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEdBQUcsMkJBQTJCLEVBQXNDLEVBQUUsTUFBNkIsRUFBRSxFQUFFLENBQUM7SUFDOUssTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNyQyxJQUFJLEtBQUssRUFBRSxNQUFNLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDaEQsc0NBQXNDO1FBQ3RDLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyw2QkFBNkIsRUFBRSxDQUFDO1lBQ2pELElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssV0FBVyxFQUFFLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7QUFBQSxDQUNGLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLGlCQUFpQixDQUNoRCxLQUFLLEVBQ0gsS0FBMkIsRUFBRSxjQUFxQyxFQUNsRSxFQUFFLENBQUM7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDakMsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ3BFLE1BQU0sTUFBTSxDQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ2pELGNBQWMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUFBLENBQ3RCLENBQUMsQ0FBQztBQUVMLGVBQWUsT0FBTyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQGxsbS10cy1leGFtcGxlL2NvbW1vbi1iYWNrZW5kJztcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBjcmVhdGVBZ2VudCB9IGZyb20gJy4vYWdlbnQuanMnO1xuXG5leHBvcnQgY29uc3QgaGFuZGxlID0gYXN5bmMgKHsgbWVzc2FnZTogbWVzc2FnZSA9ICfjgZPjgpPjgavjgaHjga/vvIEnLCBtb2RlbDogbW9kZWwgPSAndXMuYW1hem9uLm5vdmEtbWljcm8tdjE6MCcgfTogeyBtZXNzYWdlOiBzdHJpbmcsIG1vZGVsOiBzdHJpbmcgfSwgb3V0cHV0OiBOb2RlSlMuV3JpdGFibGVTdHJlYW0pID0+IHtcbiAgY29uc3QgYWdlbnQgPSBjcmVhdGVBZ2VudCh7IG1vZGVsIH0pO1xuICBmb3IgYXdhaXQgKGNvbnN0IGV2ZW50IG9mIGFnZW50LnN0cmVhbShtZXNzYWdlKSkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdbRXZlbnRdJywgZXZlbnQudHlwZSk7XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09ICdtb2RlbENvbnRlbnRCbG9ja0RlbHRhRXZlbnQnKSB7XG4gICAgICBpZiAoZXZlbnQuZGVsdGEudHlwZSA9PT0gJ3RleHREZWx0YScpIHtcbiAgICAgICAgb3V0cHV0LndyaXRlKGV2ZW50LmRlbHRhLnRleHQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhd3NsYW1iZGEuc3RyZWFtaWZ5UmVzcG9uc2UoXG4gIGFzeW5jIChcbiAgICBldmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnQsIHJlc3BvbnNlU3RyZWFtOiBOb2RlSlMuV3JpdGFibGVTdHJlYW0sXG4gICkgPT4ge1xuICAgIGxvZ2dlci5kZWJ1ZygnZXZlbnQnLCB7IGV2ZW50IH0pO1xuICAgIGNvbnN0IHsgbWVzc2FnZSwgbW9kZWwgfSA9IGV2ZW50LmJvZHkgPyBKU09OLnBhcnNlKGV2ZW50LmJvZHkpIDoge307XG4gICAgYXdhaXQgaGFuZGxlKHsgbWVzc2FnZSwgbW9kZWwgfSwgcmVzcG9uc2VTdHJlYW0pO1xuICAgIHJlc3BvbnNlU3RyZWFtLmVuZCgpO1xuICB9KTtcblxuZXhwb3J0IGRlZmF1bHQgaGFuZGxlcjtcbiJdfQ==